// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  image         String?
  emailVerified DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  senders       Sender[]
  
  @@map("users")
}

model Sender {
  id            String    @id @default(cuid())
  userId        String
  email         String
  name          String?
  hourlyLimit   Int       @default(50) // Max emails per hour
  delaySeconds  Int       @default(2)  // Delay between sends
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  emailJobs     EmailJob[]
  
  @@unique([userId, email])
  @@map("senders")
}

model EmailJob {
  id            String        @id @default(cuid())
  senderId      String
  recipient     String
  subject       String
  body          String        @db.Text
  status        EmailStatus   @default(PENDING)
  scheduledAt   DateTime
  sentAt        DateTime?
  error         String?       @db.Text
  retryCount    Int           @default(0)
  maxRetries    Int           @default(3)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  sender        Sender        @relation(fields: [senderId], references: [id], onDelete: Cascade)
  
  @@index([senderId, status])
  @@index([scheduledAt])
  @@index([status])
  @@map("email_jobs")
}

enum EmailStatus {
  PENDING
  SCHEDULED
  SENT
  FAILED
}
